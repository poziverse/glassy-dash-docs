name: Lint Documentation

on:
  pull_request:
    paths:
      - 'GLASSYDASH/docs/**'
      - 'README.md'
      - 'QUICKSTART.md'
      - 'SUPPORT.md'
      - 'CHANGELOG.md'
      - 'CODE_OF_CONDUCT.md'
      - 'LICENSE.md'

jobs:
  markdown-lint:
    name: Markdown Lint
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'

      - name: Install Markdown Lint CLI
        run: npm install -g markdownlint-cli

      - name: Lint Documentation
        run: |
          markdownlint README.md QUICKSTART.md SUPPORT.md CHANGELOG.md CODE_OF_CONDUCT.md LICENSE.md 'GLASSYDASH/docs/**/*.md'

      - name: Check for Broken Links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          use-verbose-mode: 'yes'
          config-file: '.github/markdown-link-check.json'

      - name: Check Code Blocks
        uses: LizardByte/test-code-blocks@v1
        with:
          files: |
            README.md
            QUICKSTART.md
            SUPPORT.md
            CHANGELOG.md
            GLASSYDASH/docs/**/*.md

      - name: Annotate PR with Lint Results
        if: failure()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: '⚠️ **Documentation Linting Failed**\n\nPlease fix the following issues before merging:\n\n- Markdown linting errors\n- Broken links\n- Invalid code blocks\n\nRun `npm run lint:docs` locally to see the errors.'
            })

      - name: Set PR Status
        if: always()
        uses: actions/github-script@v7
        with:
          script: |
            github.rest.repos.createCommitStatus({
              owner: context.repo.owner,
              repo: context.repo.repo,
              sha: context.sha,
              state: '${{ job.status }}',
              description: 'Documentation linting',
              context: 'docs/lint'
            })